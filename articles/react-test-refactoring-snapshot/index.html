<!DOCTYPE html><html  lang="fr-FR" dir="ltr" class="" style=""><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Refactoring React: d√©barassons-nous du code legacy avec les tests de snapshot - Florent Berthelot</title><style>a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{border:0;font-size:100%;font:inherit;margin:0;padding:0;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-collapse:collapse;border-spacing:0}#__layout,#__nuxt,body,html{height:100%}#layout_default{--color-white:#f6f6f6;--color-light:#a991dd;--color-bright:#a70000;--color-medium:#084108;--color-dark:#5d0854;--color-black:#1f2933;--font-sans-serif:Verdana,Geneva,sans-serif;--font-cursive:suicide-squad,"Comic Sans MS","Comic Sans",cursive}@font-face{font-display:swap;font-family:suicide-squad;src:url(/fonts/suicide-squad.ttf)}#layout_default .typo_default{font-family:var(--font-sans-serif);font-size:1rem;line-height:1.3rem}#layout_default .typo_meta-info,#layout_default .typo_meta-info--link{font-family:var(--font-sans-serif);font-size:.7rem;font-style:italic;line-height:1rem}#layout_default .typo_meta-info--link{text-decoration:underline}#layout_default .typo_title{font-family:var(--font-cursive);font-size:3rem;line-height:3rem}#layout_default .typo_title--small{font-family:var(--font-cursive);font-size:1.5rem;line-height:1.5rem}#layout_default .typo_title--extra-small{font-family:var(--font-cursive);font-size:1.1rem;line-height:1.5rem}#layout_default .typo_white{color:var(--color-white)}#layout_default .typo_light{color:var(--color-light)}#layout_default .typo_bright{color:var(--color-bright)}#layout_default .typo_medium{color:var(--color-medium)}#layout_default .typo_dark{color:var(--color-dark)}#layout_default .typo_black{color:var(--color-black)}#layout_default .card_meta{display:block;margin-top:.5rem;text-align:right}#layout_default .card_video{margin:3rem 0 2rem;width:100%}#layout_default .tabs{border-bottom:1px solid var(--color-dark);display:flex;justify-content:flex-end;padding-right:2rem}#layout_default .tab{background:var(--color-black);border-bottom:1px solid var(--color-dark);border:1px solid var(--color-dark);border-bottom-color:var(--color-black);border-top-left-radius:.5rem;border-top-right-radius:.5rem;box-shadow:0 -.25rem .25rem var(--color-black);box-sizing:border-box;color:var(--color-white);cursor:pointer;display:inline-block;font-family:var(--font-sans-serif);font-size:1rem;height:3rem;line-height:1.3rem;margin:0 1rem -1px;padding:1rem;position:relative;text-align:center;text-decoration:none;transform-origin:bottom center;transition:all .5s ease;width:7rem}#layout_default .tab--active{border-bottom:1px solid var(--color-light);border:1px solid var(--color-light);border-bottom-color:var(--color-black);box-shadow:0 0 1rem var(--color-light);cursor:default}#layout_default .tab:after{background-color:var(--color-black);bottom:calc(-2rem - 1px);content:"";cursor:default;display:block;height:2rem;left:-2rem;pointer-events:none;position:absolute;width:calc(100% + 4rem)}#layout_default .tab:active:not(.tab--active),#layout_default .tab:focus:not(.tab--active),#layout_default .tab:hover:not(.tab--active){border-bottom:1px solid var(--color-light);border:1px solid var(--color-light);border-bottom-color:var(--color-black);box-shadow:0 0 2rem var(--color-light);outline:none;transform:scale(1.3)}html{font-size:16px}#layout_default{background-color:var(--color-black);color:var(--color-white)}</style><style>#article-page[data-v-5ed02d59]{height:100%}.article[data-v-5ed02d59]{box-sizing:border-box;margin:3rem 25% 2rem;min-height:calc(100% - 14rem - 1px);position:relative;width:50%;z-index:1}@media screen and (max-width:850px){.article[data-v-5ed02d59]{margin:0;padding:2rem 1rem;width:100%}}</style><style>.article h2,.article h3,.article h4,.article h5,.article h6{font-family:var(--font-cursive);margin:.5rem}.article h2{font-size:2rem;line-height:2.4rem}.article h3{font-size:1.5rem;line-height:2rem}.article h4{font-size:1.2rem;line-height:1.5rem}.article h5{font-size:1rem;line-height:1.3rem}.article h6{font-size:.7rem;line-height:1rem}.article p{line-height:1.3rem;margin:1rem}.article a{color:var(--color-light);text-decoration:none;transition:all .3s ease}.article a:hover{text-decoration:underline}.article a:active{color:var(--color-dark)}.article strong{font-weight:700}.article em{font-style:italic}.article blockquote{border-left:2px solid var(--color-light);padding-left:.5rem}.article code{background-color:var(--color-dark);border-radius:.25rem;padding:.125rem .25rem}.article pre{display:block;font-size:.75rem;margin:.5rem;padding:.5rem;word-break:break-all;word-wrap:break-word;background-color:var(--color-white);border:1px solid var(--color-light);border-radius:.125rem;overflow-x:auto}.article pre code{border-radius:0;padding:0}.article ul{list-style:disc;padding-left:3rem}.article ol{list-style:decimal;padding-left:3rem}.article img{max-width:35%;vertical-align:middle}.article .main-image{max-width:100%;width:100%}.article table{margin:2rem}.article thead tr{border-bottom:2px solid var(--color-light);font-weight:700}.article th{padding:.5rem}.article tbody tr:not(:last-child){border-bottom:2px solid var(--color-dark)}.article td{padding:.5rem}</style><style>.header[data-v-b256a921]{display:flex;flex-direction:column;height:9rem}.first_row[data-v-b256a921]{align-items:center;display:flex;justify-content:space-between}.home_link[data-v-b256a921]{margin:.5rem}.language-switcher[data-v-b256a921]{align-self:flex-start;margin:.5rem;padding:.5rem}.tabs[data-v-b256a921]{margin-top:-2rem}@media screen and (max-width:850px){.header[data-v-b256a921]{height:auto}.language-switcher[data-v-b256a921]{position:absolute;right:1rem;top:1rem}.first_row[data-v-b256a921]{align-items:center;flex-direction:column;height:auto;margin-bottom:2rem}.title[data-v-b256a921]{margin-bottom:1rem;text-align:center;width:auto}#layout_default .header .tabs[data-v-b256a921]{align-self:center;justify-content:center;margin-top:0;padding-right:0}#layout_default .header .tabs .tab[data-v-b256a921]{font-size:.8rem;margin:0 .5rem -1px;padding:.5rem;width:auto}}</style><style>.avatar[data-v-965a2279]{height:8rem;perspective:50rem;width:8rem}.avatar__flip-container[data-v-965a2279]{position:relative;transform-style:preserve-3d;transition:all .6s ease}.avatar:hover .avatar__flip-container[data-v-965a2279]{transform:rotateY(180deg)}.avatar__face-a[data-v-965a2279],.avatar__face-b[data-v-965a2279]{backface-visibility:hidden;border-radius:50%;height:8rem;left:0;position:absolute;top:0;width:8rem}.apear-enter-active[data-v-965a2279],.apear-leave-active[data-v-965a2279]{transition:all .5s ease}.apear-enter[data-v-965a2279],.apear-leave-to[data-v-965a2279]{opacity:0}.avatar__face-a[data-v-965a2279]{transform:rotateY(0)}.avatar__face-b[data-v-965a2279]{transform:rotateY(180deg)}</style><style>.languageSwitcher a[data-v-39aece94]{color:var(--color-white);text-decoration:none}</style><style>.footer[data-v-ff26e94e]{align-items:center;border-bottom:2px solid var(--color-dark);box-sizing:border-box;display:flex;height:5rem;justify-content:space-around}.social-network[data-v-ff26e94e]{display:flex;justify-content:flex-end}.social-network a[data-v-ff26e94e]{background:var(--color-dark);border-bottom:1px solid var(--color-dark);border:1px solid var(--color-dark);border-bottom-color:var(--color-black);box-shadow:0 -.25rem .25rem var(--color-black);box-sizing:border-box;cursor:pointer;display:inline-block;font-size:.8rem;height:5rem;margin:0 0 -1px;padding:1rem;position:relative;text-align:center;text-decoration:none;transform-origin:bottom center;transition:all .5s ease;width:6rem}.social-network a img[data-v-ff26e94e]{height:2rem;padding:0 1rem}.social-network a[data-v-ff26e94e]:focus,.social-network a[data-v-ff26e94e]:hover{border-bottom:1px solid var(--color-light);border:1px solid var(--color-light);border-bottom-color:var(--color-black);box-shadow:0 0 2rem var(--color-light);outline:none;transform:scale(1.3);z-index:10}@media screen and (max-width:850px){.social-network[data-v-ff26e94e]{justify-content:center;padding:0}.social-network a[data-v-ff26e94e]{font-size:.7rem;padding:.5rem 0;width:4.5rem}}</style><style>pre code .line{display:block}</style><link rel="stylesheet" href="/_nuxt/header.CNPwsicA.css" crossorigin><link rel="stylesheet" href="/_nuxt/avatar.DTLC67BM.css" crossorigin><link rel="stylesheet" href="/_nuxt/footer.DwmE9ec_.css" crossorigin><link rel="preload" as="fetch" crossorigin="anonymous" href="/articles/react-test-refactoring-snapshot/_payload.json?1a17b6f7-15b9-4dae-a90c-9fc95c1f74f0"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DQxsgHZ-.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DVZ5xp-A.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dn8p7Qd9.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DnoVFMBU.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BiOPQVia.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Bc8F_hRk.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/edfe7xWi.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/MnH0zqm_.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Bqweiwd0.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/bwAbDmQe.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Pj6B3HAZ.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/C10P036D.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/bYb_heql.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BczSSewO.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CVUuaa2o.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CPZCGAYB.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DwsIPe_Q.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CX82WJmx.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CgCyaSmX.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DzlyCZs8.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BpkqNCIP.js"><link rel="preload" as="fetch" fetchpriority="low" crossorigin="anonymous" href="/_nuxt/builds/meta/1a17b6f7-15b9-4dae-a90c-9fc95c1f74f0.json"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><meta property="og:image" content="/illustrations/cowboy.jpg"><meta name="twitter:image" content="/illustrations/cowboy.jpg"><meta name="description" content="Vous voulez refactoriser une grande base de code React mais vous n'√™tes pas s√ªr de ne rien casser ? Je vais vous guider √† travers cela !"><meta name="format-detection" content="telephone=no"><meta property="og:url" content="https://berthelot.io/articles/react-test-refactoring-snapshot"><meta id="i18n-og" property="og:locale" content="fr_FR"><meta id="i18n-og-alt-en-GB" property="og:locale:alternate" content="en_GB"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link id="i18n-xd" rel="alternate" href="https://berthelot.io/articles/react-test-refactoring-snapshot" hreflang="x-default"><link id="i18n-alt-fr" rel="alternate" href="https://berthelot.io/articles/react-test-refactoring-snapshot" hreflang="fr"><link id="i18n-alt-fr-FR" rel="alternate" href="https://berthelot.io/articles/react-test-refactoring-snapshot" hreflang="fr-FR"><link id="i18n-alt-en" rel="alternate" href="https://berthelot.io/en/articles/react-test-refactoring-snapshot" hreflang="en"><link id="i18n-alt-en-GB" rel="alternate" href="https://berthelot.io/en/articles/react-test-refactoring-snapshot" hreflang="en-GB"><link id="i18n-can" rel="canonical" href="https://berthelot.io/articles/react-test-refactoring-snapshot"><meta property="og:type" content="article"><meta property="og:title" content="Refactoring React: d√©barassons-nous du code legacy avec les tests de snapshot - Florent Berthelot"><meta name="twitter:title" content="Refactoring React: d√©barassons-nous du code legacy avec les tests de snapshot - Florent Berthelot"><meta property="og:description" content="Vous voulez refactoriser une grande base de code React mais vous n'√™tes pas s√ªr de ne rien casser ? Je vais vous guider √† travers cela !"><meta name="twitter:description" content="Vous voulez refactoriser une grande base de code React mais vous n'√™tes pas s√ªr de ne rien casser ? Je vais vous guider √† travers cela !"><meta name="twitter:card" content="summary_large_image"><meta property="og:article:published:time" content="2020/06/04"><meta property="og:article:modified:time" content="2023/11/19"><meta property="og:article:author" content="https://berthelot.io"><script type="module" src="/_nuxt/DQxsgHZ-.js" crossorigin></script></head><body  id="layout_default" class="" style=""><div id="__nuxt"><!--[--><!--[--><!----><!----><!----><!----><!----><!--[--><!----><!----><!----><!----><!----><!----><!--]--><!--[--><!----><!----><!----><!--]--><!--]--><!--[--><!--[--><div></div><div id="article-page" data-v-5ed02d59><header class="header" data-v-5ed02d59 data-v-b256a921><div class="first_row" data-v-b256a921><a href="/articles" class="home_link" aria-label="Back to home" data-v-b256a921><div class="avatar" data-v-b256a921 data-v-965a2279><div class="avatar__flip-container" data-v-965a2279><img src="/assets/florent/avatar.jpg" alt="Une photo de Florent avec des lunettes de soleil oranges." class="avatar__face-a" data-v-965a2279><img src="/assets/florent/joker.jpg" alt="Une photo du joker, un personnage que j&#39;aime beaucoup car toujours souriant." class="avatar__face-b" data-v-965a2279></div></div></a><h1 class="typo_title title" data-v-b256a921>Refactoring React: d√©barassons-nous du code legacy avec les tests de snapshot</h1><div class="typo_default languageSwitcher language-switcher" data-v-b256a921 data-v-39aece94><a href="/en/articles/react-test-refactoring-snapshot" class="" data-v-39aece94>EN</a><!----></div></div><nav class="tabs" data-v-b256a921><a href="/articles" class="tab tab--active" tabindex="-1" data-v-b256a921>Articles</a><a href="/courses" class="tab" tabindex="0" data-v-b256a921>Cours</a><a href="/talks" class="tab" tabindex="0" data-v-b256a921>Talks</a><a href="/activities" class="tab" tabindex="0" data-v-b256a921>Activit√©s</a></nav></header><div class="typo_default article" data-v-5ed02d59><img src="/illustrations/cowboy.jpg" alt="Le cowboy du refactoring" class="main-image"><p><!--[-->Il √©tait une fois, un pauvre cowboy d√©veloppeur solitaire. Il avait un long code √† refactoriser. Chaque fois qu&#39;il arrivait dans une nouvelle ville, il tirait plus vite que son ombre sur le code legacy.<!--]--></p><p><!--[-->C&#39;est un frelance, donc il rejoint des √©quipes en place, pour refactoriser et am√©liorer la qualit√© des codes.<!--]--></p><p><!--[-->Alors que le cowboy d√©veloppeur lit le code legacy, il a tendance √† tout refactoriser.
Il √©crit du nouveau code propre et teste correctement son code.
Mais, √† la fin, son refactoring tombe toujours sur un cas fonctionel particulier dont il n&#39;avait pas conaissance et voil√†‚Ä¶
Malgr√© les tests qu&#39;il avait cr√©√©s, il a introduit des bugs ! üò®.<!--]--></p><p><!--[-->Qu&#39;est-ce qui ne va pas avec ce processus ?<!--]--></p><p><!--[-->Il y a deux grandes failles dans sa fa√ßon de refactoriser :<!--]--></p><ul><!--[--><li><!--[-->notre cowboy refactorise un syst√®me entier sans conna√Ætre le comportement exact<!--]--></li><li><!--[-->notre cowboy teste son code en fonction du code refactoris√© et non en fonction des deux versions du code : le legacy et le nouveau.<!--]--></li><!--]--></ul><p><!--[-->Alors que la premi√®re erreur est difficile √† corriger, nous allons am√©liorer le processus du d√©veloppeur cowboy en changeant la fa√ßon dont il refactorise le code.<!--]--></p><h2 id="tester-le-code-legacy"><a href="#tester-le-code-legacy"><!--[-->Tester le code legacy<!--]--></a></h2><p><!--[-->La premi√®re √©tape pour refactoriser avec succ√®s un morceau de code est d&#39;ajouter des tests au code legacy.
M√™me si les tests devraient toujours se r√©f√©rer √† un comportement tout en gardant √† l&#39;esprit l&#39;empathie avec l&#39;utilisateur,
dans notre cas c&#39;est impossible √† faire vu que l&#39;on ne conna√Æt pas le fonctionel !<!--]--></p><p><!--[-->Nous devons trouver une autre fa√ßon de proc√©der.
Le premier outil que nous utiliserons : les tests de snapshot Jest.<!--]--></p><p><!--[-->Qu&#39;est-ce qu&#39;un test de snapshot ? C&#39;est simple :<!--]--></p><ul><!--[--><li><!--[-->Prenez un snapshot d&#39;un composant<!--]--></li><li><!--[-->Modifiez le code<!--]--></li><li><!--[-->Prenez un autre snapshot apr√®s que le code ai √©t√© modifi√©<!--]--></li><li><!--[-->Comparez les deux snapshot (avant et apr√®s le refactoring). Ils devraient √™tre exactement les m√™mes.<!--]--></li><!--]--></ul><p><!--[-->Cela signifie que la sortie du composant devrait √™tre la m√™me avant et apr√®s le refactoring.
Essayons cela avec un peu de code.<!--]--></p><p><!--[-->Imaginez une application que notre cowboy d√©veloppeur utilise pour compter les vaches et conserver des donn√©es sur elles.
Voici l&#39;application :<!--]--></p><p><!--[-->Le code :<!--]--></p><pre class="language-jsx shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="szBVR">import</span><span class="sVt8B"> React </span><span class="szBVR">from</span><span class="sZZnC"> &#39;react&#39;
</span></span><span class="line" line="2"><span class="szBVR">import</span><span class="sZZnC"> &#39;bulma&#39;
</span></span><span class="line" line="3"><span class="szBVR">import</span><span class="sZZnC"> &#39;./styles.css&#39;
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span class="szBVR">export</span><span class="szBVR"> default</span><span class="szBVR"> function</span><span class="sScJk"> App</span><span class="sVt8B">() {
</span></span><span class="line" line="6"><span class="szBVR">  return</span><span class="sVt8B"> (
</span></span><span class="line" line="7"><span class="sVt8B">    &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;App&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="8"><span class="sVt8B">      &lt;</span><span class="s9eBZ">h1</span><span class="sVt8B">&gt;MY COWS&lt;/</span><span class="s9eBZ">h1</span><span class="sVt8B">&gt;
</span></span><span class="line" line="9"><span emptylineplaceholder="true">
</span></span><span class="line" line="10"><span class="sVt8B">      &lt;</span><span class="s9eBZ">section</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;cows&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="11"><span class="sVt8B">        &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="12"><span class="sVt8B">          &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card-image&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="13"><span class="sVt8B">            &lt;</span><span class="s9eBZ">figure</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;image is-4by3&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="14"><span class="sVt8B">              &lt;</span><span class="s9eBZ">img</span><span class="sScJk"> src</span><span class="szBVR">=</span><span class="sZZnC">&quot;https://lh3.googleusercontent.com/eLxDr87icLAQlzF2LFIig62i46hm7f8sH77zIaZX6t64kFsjHlok6QMyCiReOzBcfpkPTZSv3g=w640-h400-e365&quot;</span><span class="sVt8B"> /&gt;
</span></span><span class="line" line="15"><span class="sVt8B">            &lt;/</span><span class="s9eBZ">figure</span><span class="sVt8B">&gt;
</span></span><span class="line" line="16"><span class="sVt8B">          &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="17"><span emptylineplaceholder="true">
</span></span><span class="line" line="18"><span class="sVt8B">          &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card-content&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="19"><span class="sVt8B">            &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;media&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="20"><span class="sVt8B">              &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;media-content&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="21"><span class="sVt8B">                &lt;</span><span class="s9eBZ">p</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;title is-4&quot;</span><span class="sVt8B">&gt;Margueritte&lt;/</span><span class="s9eBZ">p</span><span class="sVt8B">&gt;
</span></span><span class="line" line="22"><span class="sVt8B">                &lt;</span><span class="s9eBZ">p</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;subtitle is-6&quot;</span><span class="sVt8B">&gt;Field A&lt;/</span><span class="s9eBZ">p</span><span class="sVt8B">&gt;
</span></span><span class="line" line="23"><span class="sVt8B">              &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="24"><span class="sVt8B">            &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="25"><span emptylineplaceholder="true">
</span></span><span class="line" line="26"><span class="sVt8B">            &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;content&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="27"><span class="sVt8B">              She love organize poker game in the basment of the farm.
</span></span><span class="line" line="28"><span class="sVt8B">            &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="29"><span class="sVt8B">          &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="30"><span class="sVt8B">        &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="31"><span emptylineplaceholder="true">
</span></span><span class="line" line="32"><span class="sVt8B">        &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="33"><span class="sVt8B">          &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card-image&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="34"><span class="sVt8B">            &lt;</span><span class="s9eBZ">figure</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;image is-4by3&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="35"><span class="sVt8B">              &lt;</span><span class="s9eBZ">img</span><span class="sScJk"> src</span><span class="szBVR">=</span><span class="sZZnC">&quot;https://image.posterlounge.fr/img/products/650000/649832/649832_poster_l.jpg&quot;</span><span class="sVt8B"> /&gt;
</span></span><span class="line" line="36"><span class="sVt8B">            &lt;/</span><span class="s9eBZ">figure</span><span class="sVt8B">&gt;
</span></span><span class="line" line="37"><span class="sVt8B">          &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="38"><span emptylineplaceholder="true">
</span></span><span class="line" line="39"><span class="sVt8B">          &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card-content&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="40"><span class="sVt8B">            &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;media&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="41"><span class="sVt8B">              &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;media-content&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="42"><span class="sVt8B">                &lt;</span><span class="s9eBZ">p</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;title is-4&quot;</span><span class="sVt8B">&gt;Th√©r√®se&lt;/</span><span class="s9eBZ">p</span><span class="sVt8B">&gt;
</span></span><span class="line" line="43"><span class="sVt8B">                &lt;</span><span class="s9eBZ">p</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;subtitle is-6&quot;</span><span class="sVt8B">&gt;Field A&lt;/</span><span class="s9eBZ">p</span><span class="sVt8B">&gt;
</span></span><span class="line" line="44"><span class="sVt8B">              &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="45"><span class="sVt8B">            &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="46"><span emptylineplaceholder="true">
</span></span><span class="line" line="47"><span class="sVt8B">            &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;content&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="48"><span class="sVt8B">              During the confinement, her hair grown up significantly.
</span></span><span class="line" line="49"><span class="sVt8B">            &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="50"><span class="sVt8B">          &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="51"><span class="sVt8B">        &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="52"><span emptylineplaceholder="true">
</span></span><span class="line" line="53"><span class="sVt8B">        &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="54"><span class="sVt8B">          &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card-image&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="55"><span class="sVt8B">            &lt;</span><span class="s9eBZ">figure</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;image is-4by3&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="56"><span class="sVt8B">              &lt;</span><span class="s9eBZ">img</span><span class="sScJk"> src</span><span class="szBVR">=</span><span class="sZZnC">&quot;https://oldmooresalmanac.com/wp-content/uploads/2017/11/cow-2896329_960_720-Copy-476x459.jpg&quot;</span><span class="sVt8B"> /&gt;
</span></span><span class="line" line="57"><span class="sVt8B">            &lt;/</span><span class="s9eBZ">figure</span><span class="sVt8B">&gt;
</span></span><span class="line" line="58"><span class="sVt8B">          &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="59"><span emptylineplaceholder="true">
</span></span><span class="line" line="60"><span class="sVt8B">          &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card-content&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="61"><span class="sVt8B">            &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;media&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="62"><span class="sVt8B">              &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;media-content&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="63"><span class="sVt8B">                &lt;</span><span class="s9eBZ">p</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;title is-4&quot;</span><span class="sVt8B">&gt;Evelyne&lt;/</span><span class="s9eBZ">p</span><span class="sVt8B">&gt;
</span></span><span class="line" line="64"><span class="sVt8B">                &lt;</span><span class="s9eBZ">p</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;subtitle is-6&quot;</span><span class="sVt8B">&gt;Field B&lt;/</span><span class="s9eBZ">p</span><span class="sVt8B">&gt;
</span></span><span class="line" line="65"><span class="sVt8B">              &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="66"><span class="sVt8B">            &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="67"><span emptylineplaceholder="true">
</span></span><span class="line" line="68"><span class="sVt8B">            &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;content&quot;</span><span class="sVt8B">&gt;She smile to me, it&#39;s weird.&lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="69"><span class="sVt8B">          &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="70"><span class="sVt8B">        &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="71"><span class="sVt8B">      &lt;/</span><span class="s9eBZ">section</span><span class="sVt8B">&gt;
</span></span><span class="line" line="72"><span class="sVt8B">    &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="73"><span class="sVt8B">  )
</span></span><span class="line" line="74"><span class="sVt8B">}
</span></span></code><!--]--></pre><p><!--[-->L&#39;application:<!--]--></p><iframe src="https://codesandbox.io/embed/github/FBerthelot/my-cows-react-refactoring-kata/tree/master/?fontsize=14&amp;hidenavigation=1&amp;theme=dark&amp;view=preview" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" title="my-cows-react-refactoring-kata" allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking" sandbox="allow-autoplay allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"></iframe><p><!--[-->Le code est assez simple. Il y a un titre et un compteur de vaches.
Le compteur de vaches est un composant qui contient toute la logique.<!--]--></p><p><!--[-->Quand on voit ce code, la premi√®re chose que l&#39;on veut faire est de cr√©er un composant Cow pour chaque vache.
Pour respecter notre workflow de refactoring, nous allons d&#39;abord ajouter des tests de snapshot au composant App.<!--]--></p><h3 id="rendering-du-component-pour-un-snapshot"><a href="#rendering-du-component-pour-un-snapshot"><!--[-->Rendering du component pour un snapshot<!--]--></a></h3><p><!--[-->Dans l&#39;√©cosysteme React, il y a deux grandes librairies pour tester les composants : Enzyme et @testing-library.
J&#39;ai aussi cr√©√© <a href="https://component-test-utils.berthelot.io/" rel="nofollow"><!--[-->ma propre librairie, component-test-utils<!--]--></a> plus t√¥t cette ann√©e et je vais √©crire les tests avec chaque librairie pour que vous puissiez avoir l&#39;exemple avec celle que vous utilisez.<!--]--></p><p><!--[-->Peut importe la librairie de test que vous utilisez, assurez-vous de rendre tout l&#39;arbre React et pas seulement un seul composant, donc il <em><!--[-->ne pas utiliser de mock pendant le refactoring<!--]--></em>.<!--]--></p><pre class="language-jsx shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="szBVR">import</span><span class="sVt8B"> App </span><span class="szBVR">from</span><span class="sZZnC"> &#39;./App&#39;
</span></span><span class="line" line="2"><span class="szBVR">import</span><span class="sVt8B"> React </span><span class="szBVR">from</span><span class="sZZnC"> &#39;react&#39;
</span></span><span class="line" line="3"><span class="szBVR">import</span><span class="sVt8B"> renderer </span><span class="szBVR">from</span><span class="sZZnC"> &#39;react-test-renderer&#39;
</span></span><span class="line" line="4"><span class="szBVR">import</span><span class="sVt8B"> { shallow } </span><span class="szBVR">from</span><span class="sZZnC"> &#39;component-test-utils-react&#39;
</span></span><span class="line" line="5"><span class="szBVR">import</span><span class="sVt8B"> { render } </span><span class="szBVR">from</span><span class="sZZnC"> &#39;@testing-library/react&#39;
</span></span><span class="line" line="6"><span class="szBVR">import</span><span class="sVt8B"> Enzyme, { mount } </span><span class="szBVR">from</span><span class="sZZnC"> &#39;enzyme&#39;
</span></span><span class="line" line="7"><span class="szBVR">import</span><span class="sVt8B"> Adapter </span><span class="szBVR">from</span><span class="sZZnC"> &#39;enzyme-adapter-react-16&#39;
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span class="sVt8B">Enzyme.</span><span class="sScJk">configure</span><span class="sVt8B">({ adapter: </span><span class="szBVR">new</span><span class="sScJk"> Adapter</span><span class="sVt8B">() })
</span></span><span class="line" line="10"><span emptylineplaceholder="true">
</span></span><span class="line" line="11"><span class="sJ8bj">// React test render
</span></span><span class="line" line="12"><span class="sScJk">describe</span><span class="sVt8B">(</span><span class="sZZnC">&#39;App - react-test-render - Refactoring Tests&#39;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="13"><span class="sScJk">  it</span><span class="sVt8B">(</span><span class="sZZnC">&#39;should look the same&#39;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="14"><span class="szBVR">    const</span><span class="sj4cs"> tree</span><span class="szBVR"> =</span><span class="sVt8B"> renderer.</span><span class="sScJk">create</span><span class="sVt8B">(&lt;</span><span class="sj4cs">App</span><span class="sVt8B"> /&gt;).</span><span class="sScJk">toJSON</span><span class="sVt8B">()
</span></span><span class="line" line="15"><span class="sScJk">    expect</span><span class="sVt8B">(tree).</span><span class="sScJk">toMatchSnapshot</span><span class="sVt8B">()
</span></span><span class="line" line="16"><span class="sVt8B">  })
</span></span><span class="line" line="17"><span class="sVt8B">})
</span></span><span class="line" line="18"><span emptylineplaceholder="true">
</span></span><span class="line" line="19"><span class="sJ8bj">// Enzyme
</span></span><span class="line" line="20"><span class="sScJk">describe</span><span class="sVt8B">(</span><span class="sZZnC">&#39;App - enzyme - Refactoring Tests&#39;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="21"><span class="sScJk">  it</span><span class="sVt8B">(</span><span class="sZZnC">&#39;should look the same&#39;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="22"><span class="szBVR">    const</span><span class="sj4cs"> component</span><span class="szBVR"> =</span><span class="sScJk"> mount</span><span class="sVt8B">(&lt;</span><span class="sj4cs">App</span><span class="sVt8B"> /&gt;)
</span></span><span class="line" line="23"><span class="sScJk">    expect</span><span class="sVt8B">(component.</span><span class="sScJk">html</span><span class="sVt8B">()).</span><span class="sScJk">toMatchSnapshot</span><span class="sVt8B">()
</span></span><span class="line" line="24"><span class="sVt8B">  })
</span></span><span class="line" line="25"><span class="sVt8B">})
</span></span><span class="line" line="26"><span emptylineplaceholder="true">
</span></span><span class="line" line="27"><span class="sJ8bj">// component-test-utils-react
</span></span><span class="line" line="28"><span class="sScJk">describe</span><span class="sVt8B">(</span><span class="sZZnC">&#39;App - component-test-utils-react - Refactoring Tests&#39;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="29"><span class="sScJk">  it</span><span class="sVt8B">(</span><span class="sZZnC">&#39;should look the same&#39;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="30"><span class="szBVR">    const</span><span class="sj4cs"> component</span><span class="szBVR"> =</span><span class="sScJk"> shallow</span><span class="sVt8B">(&lt;</span><span class="sj4cs">App</span><span class="sVt8B"> /&gt;, { blackList: </span><span class="sj4cs">true</span><span class="sVt8B"> })
</span></span><span class="line" line="31"><span class="sScJk">    expect</span><span class="sVt8B">(component.</span><span class="sScJk">html</span><span class="sVt8B">({ snapshot: </span><span class="sj4cs">true</span><span class="sVt8B"> })).</span><span class="sScJk">toMatchSnapshot</span><span class="sVt8B">()
</span></span><span class="line" line="32"><span class="sVt8B">  })
</span></span><span class="line" line="33"><span class="sVt8B">})
</span></span><span class="line" line="34"><span emptylineplaceholder="true">
</span></span><span class="line" line="35"><span class="sJ8bj">// @testing-library
</span></span><span class="line" line="36"><span class="sScJk">describe</span><span class="sVt8B">(</span><span class="sZZnC">&#39;App - @testing-library/react - Refactoring Tests&#39;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="37"><span class="sScJk">  it</span><span class="sVt8B">(</span><span class="sZZnC">&#39;should look the same&#39;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="38"><span class="szBVR">    const</span><span class="sVt8B"> { </span><span class="sj4cs">container</span><span class="sVt8B"> } </span><span class="szBVR">=</span><span class="sScJk"> render</span><span class="sVt8B">(&lt;</span><span class="sj4cs">App</span><span class="sVt8B"> /&gt;)
</span></span><span class="line" line="39"><span class="sScJk">    expect</span><span class="sVt8B">(container.firstChild).</span><span class="sScJk">toMatchSnapshot</span><span class="sVt8B">()
</span></span><span class="line" line="40"><span class="sVt8B">  })
</span></span><span class="line" line="41"><span class="sVt8B">})
</span></span></code><!--]--></pre><p><!--[-->Quand on execute les tests, Jest va cr√©er un dossier <code><!--[-->__snapshots__<!--]--></code> avec une copie de l&#39;arbre React.
Si vous faites des changements, Jest va v√©rifier si le nouveau code g√©n√®re le m√™me arbre React.<!--]--></p><h3 id="cr√©ation-dun-composant-vache"><a href="#cr√©ation-dun-composant-vache"><!--[-->Cr√©ation d&#39;un composant Vache<!--]--></a></h3><p><!--[-->Maintenant que nous avons des tests de snapshot, nous pouvons refactoriser le code en suivant un workflow normal de d√©veloppement, par exemple TDD.<!--]--></p><pre class="language-jsx shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="szBVR">import</span><span class="sVt8B"> React </span><span class="szBVR">from</span><span class="sZZnC"> &#39;react&#39;
</span></span><span class="line" line="2"><span class="szBVR">import</span><span class="sVt8B"> { Cow } </span><span class="szBVR">from</span><span class="sZZnC"> &#39;./Cow&#39;
</span></span><span class="line" line="3"><span class="szBVR">import</span><span class="sVt8B"> { shallow } </span><span class="szBVR">from</span><span class="sZZnC"> &#39;component-test-utils-react&#39;
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span class="sScJk">describe</span><span class="sVt8B">(</span><span class="sZZnC">&#39;Cow&#39;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="6"><span class="szBVR">  const</span><span class="sj4cs"> cow</span><span class="szBVR"> =</span><span class="sVt8B"> {
</span></span><span class="line" line="7"><span class="sVt8B">    name: </span><span class="sZZnC">&#39;Margueritte&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="8"><span class="sVt8B">    location: </span><span class="sZZnC">&#39;Field A&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="9"><span class="sVt8B">    description: </span><span class="sZZnC">&quot;She&#39;s smiling at me, it&#39;s weird.&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="10"><span class="sVt8B">    image: </span><span class="sZZnC">&#39;http://toto.toto.com&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="11"><span class="sVt8B">  }
</span></span><span class="line" line="12"><span class="sScJk">  it</span><span class="sVt8B">(</span><span class="sZZnC">&#39;should display cow name&#39;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="13"><span class="szBVR">    const</span><span class="sj4cs"> component</span><span class="szBVR"> =</span><span class="sScJk"> shallow</span><span class="sVt8B">(&lt;</span><span class="sj4cs">Cow</span><span class="sScJk"> cow</span><span class="szBVR">=</span><span class="sVt8B">{cow} /&gt;)
</span></span><span class="line" line="14"><span class="sScJk">    expect</span><span class="sVt8B">(component.</span><span class="sScJk">html</span><span class="sVt8B">()).</span><span class="sScJk">toContain</span><span class="sVt8B">(cow.name)
</span></span><span class="line" line="15"><span class="sVt8B">  })
</span></span><span class="line" line="16"><span emptylineplaceholder="true">
</span></span><span class="line" line="17"><span class="sScJk">  it</span><span class="sVt8B">(</span><span class="sZZnC">&#39;should display where the cow is&#39;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="18"><span class="szBVR">    const</span><span class="sj4cs"> component</span><span class="szBVR"> =</span><span class="sScJk"> shallow</span><span class="sVt8B">(&lt;</span><span class="sj4cs">Cow</span><span class="sScJk"> cow</span><span class="szBVR">=</span><span class="sVt8B">{cow} /&gt;)
</span></span><span class="line" line="19"><span class="sScJk">    expect</span><span class="sVt8B">(component.</span><span class="sScJk">html</span><span class="sVt8B">()).</span><span class="sScJk">toContain</span><span class="sVt8B">(cow.location)
</span></span><span class="line" line="20"><span class="sVt8B">  })
</span></span><span class="line" line="21"><span emptylineplaceholder="true">
</span></span><span class="line" line="22"><span class="sScJk">  it</span><span class="sVt8B">(</span><span class="sZZnC">&quot;should display the cow&#39;s description&quot;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="23"><span class="szBVR">    const</span><span class="sj4cs"> component</span><span class="szBVR"> =</span><span class="sScJk"> shallow</span><span class="sVt8B">(&lt;</span><span class="sj4cs">Cow</span><span class="sScJk"> cow</span><span class="szBVR">=</span><span class="sVt8B">{cow} /&gt;)
</span></span><span class="line" line="24"><span class="sScJk">    expect</span><span class="sVt8B">(component.</span><span class="sScJk">html</span><span class="sVt8B">()).</span><span class="sScJk">toContain</span><span class="sVt8B">(cow.description)
</span></span><span class="line" line="25"><span class="sVt8B">  })
</span></span><span class="line" line="26"><span emptylineplaceholder="true">
</span></span><span class="line" line="27"><span class="sScJk">  it</span><span class="sVt8B">(</span><span class="sZZnC">&quot;should display the cow&#39;s image&quot;</span><span class="sVt8B">, () </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="28"><span class="szBVR">    const</span><span class="sj4cs"> component</span><span class="szBVR"> =</span><span class="sScJk"> shallow</span><span class="sVt8B">(&lt;</span><span class="sj4cs">Cow</span><span class="sScJk"> cow</span><span class="szBVR">=</span><span class="sVt8B">{cow} /&gt;)
</span></span><span class="line" line="29"><span class="sScJk">    expect</span><span class="sVt8B">(component.</span><span class="sScJk">html</span><span class="sVt8B">()).</span><span class="sScJk">toContain</span><span class="sVt8B">(cow.image)
</span></span><span class="line" line="30"><span class="sVt8B">  })
</span></span><span class="line" line="31"><span class="sVt8B">})
</span></span></code><!--]--></pre><p><!--[-->Comme vous pouvez le voir, nous testons que chaque donn√©e envoy√©e au composant est affich√©e, peu importe l&#39;arbre HTML.
Le composant Cow est tr√®s simple, rien de sp√©cial ici.<!--]--></p><pre class="language-jsx shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="szBVR">import</span><span class="sVt8B"> React </span><span class="szBVR">from</span><span class="sZZnC"> &#39;react&#39;
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span class="szBVR">export</span><span class="szBVR"> const</span><span class="sScJk"> Cow</span><span class="szBVR"> =</span><span class="sVt8B"> ({ </span><span class="s4XuR">cow</span><span class="sVt8B"> }) </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="4"><span class="szBVR">  return</span><span class="sVt8B"> (
</span></span><span class="line" line="5"><span class="sVt8B">    &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="6"><span class="sVt8B">      &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card-image&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="7"><span class="sVt8B">        &lt;</span><span class="s9eBZ">figure</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;image is-4by3&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="8"><span class="sVt8B">          &lt;</span><span class="s9eBZ">img</span><span class="sScJk"> src</span><span class="szBVR">=</span><span class="sVt8B">{cow.image} /&gt;
</span></span><span class="line" line="9"><span class="sVt8B">        &lt;/</span><span class="s9eBZ">figure</span><span class="sVt8B">&gt;
</span></span><span class="line" line="10"><span class="sVt8B">      &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="11"><span emptylineplaceholder="true">
</span></span><span class="line" line="12"><span class="sVt8B">      &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;card-content&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="13"><span class="sVt8B">        &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;media&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="14"><span class="sVt8B">          &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;media-content&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="15"><span class="sVt8B">            &lt;</span><span class="s9eBZ">p</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;title is-4&quot;</span><span class="sVt8B">&gt;{cow.name}&lt;/</span><span class="s9eBZ">p</span><span class="sVt8B">&gt;
</span></span><span class="line" line="16"><span class="sVt8B">            &lt;</span><span class="s9eBZ">p</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;subtitle is-6&quot;</span><span class="sVt8B">&gt;{cow.location}&lt;/</span><span class="s9eBZ">p</span><span class="sVt8B">&gt;
</span></span><span class="line" line="17"><span class="sVt8B">          &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="18"><span class="sVt8B">        &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="19"><span emptylineplaceholder="true">
</span></span><span class="line" line="20"><span class="sVt8B">        &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;content&quot;</span><span class="sVt8B">&gt;{cow.description}&lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="21"><span class="sVt8B">      &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="22"><span class="sVt8B">    &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="23"><span class="sVt8B">  )
</span></span><span class="line" line="24"><span class="sVt8B">}
</span></span></code><!--]--></pre><h3 id="utilisation-du-composant-vache"><a href="#utilisation-du-composant-vache"><!--[-->Utilisation du composant vache<!--]--></a></h3><p><!--[-->Maintenant que notre composant est pr√™t, il est temps pour notre cowboy de d√©truire le vieux code et d&#39;utiliser sa nouvelle Card Cow.<!--]--></p><pre class="language-jsx shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="szBVR">import</span><span class="sVt8B"> React </span><span class="szBVR">from</span><span class="sZZnC"> &#39;react&#39;
</span></span><span class="line" line="2"><span class="szBVR">import</span><span class="sZZnC"> &#39;bulma&#39;
</span></span><span class="line" line="3"><span class="szBVR">import</span><span class="sZZnC"> &#39;./styles.css&#39;
</span></span><span class="line" line="4"><span class="szBVR">import</span><span class="sVt8B"> { Cow } </span><span class="szBVR">from</span><span class="sZZnC"> &#39;./Cow&#39;
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span class="szBVR">export</span><span class="szBVR"> default</span><span class="szBVR"> function</span><span class="sScJk"> App</span><span class="sVt8B">() {
</span></span><span class="line" line="7"><span class="szBVR">  const</span><span class="sj4cs"> cows</span><span class="szBVR"> =</span><span class="sVt8B"> [
</span></span><span class="line" line="8"><span class="sVt8B">    {
</span></span><span class="line" line="9"><span class="sVt8B">      name: </span><span class="sZZnC">&#39;Margueritte&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="10"><span class="sVt8B">      image:
</span></span><span class="line" line="11"><span class="sZZnC">        &#39;https://lh3.googleusercontent.com/eLxDr87icLAQlzF2LFIig62i46hm7f8sH77zIaZX6t64kFsjHlok6QMyCiReOzBcfpkPTZSv3g=w640-h400-e365&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="12"><span class="sVt8B">      location: </span><span class="sZZnC">&#39;Field A&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="13"><span class="sVt8B">      description:
</span></span><span class="line" line="14"><span class="sZZnC">        &#39;She loves organizing poker games in the basement of the farm.&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="15"><span class="sVt8B">    },
</span></span><span class="line" line="16"><span class="sVt8B">    {
</span></span><span class="line" line="17"><span class="sVt8B">      name: </span><span class="sZZnC">&#39;Th√©r√®se&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="18"><span class="sVt8B">      image:
</span></span><span class="line" line="19"><span class="sZZnC">        &#39;https://image.posterlounge.fr/img/products/650000/649832/649832_poster_l.jpg&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="20"><span class="sVt8B">      location: </span><span class="sZZnC">&#39;Field A&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="21"><span class="sVt8B">      description: </span><span class="sZZnC">&#39;During the confinement, her hair grew significantly.&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="22"><span class="sVt8B">    },
</span></span><span class="line" line="23"><span class="sVt8B">    {
</span></span><span class="line" line="24"><span class="sVt8B">      name: </span><span class="sZZnC">&#39;Evelyne&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="25"><span class="sVt8B">      image:
</span></span><span class="line" line="26"><span class="sZZnC">        &#39;https://oldmooresalmanac.com/wp-content/uploads/2017/11/cow-2896329_960_720-Copy-476x459.jpg&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="27"><span class="sVt8B">      location: </span><span class="sZZnC">&#39;Field B&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="28"><span class="sVt8B">      description: </span><span class="sZZnC">&quot;She&#39;s smiling at me, it&#39;s weird.&quot;</span><span class="sVt8B">,
</span></span><span class="line" line="29"><span class="sVt8B">    },
</span></span><span class="line" line="30"><span class="sVt8B">  ]
</span></span><span class="line" line="31"><span emptylineplaceholder="true">
</span></span><span class="line" line="32"><span class="szBVR">  return</span><span class="sVt8B"> (
</span></span><span class="line" line="33"><span class="sVt8B">    &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;App&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="34"><span class="sVt8B">      &lt;</span><span class="s9eBZ">h1</span><span class="sVt8B">&gt;MY COWS&lt;/</span><span class="s9eBZ">h1</span><span class="sVt8B">&gt;
</span></span><span class="line" line="35"><span emptylineplaceholder="true">
</span></span><span class="line" line="36"><span class="sVt8B">      &lt;</span><span class="s9eBZ">section</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;cows&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="37"><span class="sVt8B">        {cows.</span><span class="sScJk">map</span><span class="sVt8B">((</span><span class="s4XuR">cow</span><span class="sVt8B">) </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="38"><span class="szBVR">          return</span><span class="sVt8B"> &lt;</span><span class="sj4cs">Cow</span><span class="sScJk"> cow</span><span class="szBVR">=</span><span class="sVt8B">{cow} </span><span class="sScJk">key</span><span class="szBVR">=</span><span class="sVt8B">{cow.name} /&gt;
</span></span><span class="line" line="39"><span class="sVt8B">        })}
</span></span><span class="line" line="40"><span class="sVt8B">      &lt;/</span><span class="s9eBZ">section</span><span class="sVt8B">&gt;
</span></span><span class="line" line="41"><span class="sVt8B">    &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="42"><span class="sVt8B">  )
</span></span><span class="line" line="43"><span class="sVt8B">}
</span></span></code><!--]--></pre><p><!--[-->Quand on a fini de refactoriser, on peut lancer les tests de snapshot et voir si on a cass√© quelque chose.
Nous sommes donc confiants car nous sommes s√ªrs de g√©n√©rer la m√™me sortie HTML gr√¢ce √† nos tests de snapshot.<!--]--></p><h3 id="supression-du-test-de-snapshot"><a href="#supression-du-test-de-snapshot"><!--[-->Supression du test de snapshot<!--]--></a></h3><p><!--[-->Les tests de snapshot ont aid√© le cowboy √† refactoriser le code et √† cr√©er un composant Cow, mais maintenant que le refactoring est termin√©, le premier test est inutile.
Ce test de snapshot n&#39;a plus de valeur pour une future maintenance.<!--]--></p><p><!--[-->Le DOM est tr√®s mouvant, la structure HTML va probablement changer.
Ce genre de tests va apporter beaucoup de faux n√©gatifs, beaucoup de bruit lors du changement de HTML/CSS.
C&#39;est m√™me maintenant devenu un test avec plus d&#39;inconv√©gnants que d&#39;atouts.<!--]--></p><p><!--[-->√âx√©cutons la commande pr√©f√©r√©e de notre cowboy : <code><!--[-->rm ./src/App.snapshot.spec.js<!--]--></code> !<!--]--></p><h2 id="et-maintenant"><a href="#et-maintenant"><!--[-->Et maintenant ?<!--]--></a></h2><p><!--[-->Nous avons vu comment utiliser les tests de snapshot pour refactoriser du code legacy tr√®s simple.
Pour aller plus loin, vous pouvez combiner les tests de snapshot et le property-based-testing pour retrouver la logic derri√®re un code poussi√©reux.<!--]--></p><hr><p><!--[-->Le code est disponible sur <a href="https://github.com/FBerthelot/my-cows-react-refactoring-kata" rel="nofollow"><!--[-->Github<!--]--></a> et vous pouvez naviguer entre chaque √©tapes avec un syst√®me de branches.<!--]--></p><style>html pre.shiki code .szBVR, html code.shiki .szBVR{--shiki-default:#D73A49;--shiki-dark:#F97583}html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .s9eBZ, html code.shiki .s9eBZ{--shiki-default:#22863A;--shiki-dark:#85E89D}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sJ8bj, html code.shiki .sJ8bj{--shiki-default:#6A737D;--shiki-dark:#6A737D}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html pre.shiki code .s4XuR, html code.shiki .s4XuR{--shiki-default:#E36209;--shiki-dark:#FFAB70}</style></div><footer class="footer" data-v-5ed02d59 data-v-ff26e94e><ul class="social-network" data-v-ff26e94e><li data-v-ff26e94e><a class="typo_default typo_white" rel="noopener" target="_blank" href="https://twitter.com/berthel350" data-v-ff26e94e><img src="/assets/twitter.svg" alt="" data-v-ff26e94e> Twitter</a></li><li data-v-ff26e94e><a class="typo_default typo_white" rel="noopener" target="_blank" href="https://www.linkedin.com/in/florent-berthelot-dev-web/" data-v-ff26e94e><img src="/assets/linkedin.svg" alt="" data-v-ff26e94e> Linkedin</a></li><li data-v-ff26e94e><a class="typo_default typo_white" rel="noopener" target="_blank" href="https://github.com/FBerthelot" data-v-ff26e94e><img src="/assets/github.svg" alt="" data-v-ff26e94e>Github</a></li><li data-v-ff26e94e><a class="typo_default typo_white" href="mailto:florent@berthelot.io" data-v-ff26e94e><img src="/assets/email.svg" alt="" data-v-ff26e94e> Mail</a></li></ul></footer></div><!--]--><!--]--><!--]--></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/articles/react-test-refactoring-snapshot/_payload.json?1a17b6f7-15b9-4dae-a90c-9fc95c1f74f0">[{"state":1,"once":20,"_errors":21,"serverRendered":6,"path":23,"prerenderedAt":24},["Reactive",2],{"$si18n:cached-locale-configs":3,"$si18n:resolved-locale":9,"$ssite-config":10},{"fr":4,"en":7},{"fallbacks":5,"cacheable":6},[],true,{"fallbacks":8,"cacheable":6},[],"",{"_priority":11,"currentLocale":15,"defaultLocale":15,"description":16,"env":17,"name":18,"url":19},{"name":12,"env":13,"description":12,"url":14,"defaultLocale":14,"currentLocale":14},-10,-15,-2,"fr-FR","The family website","production","berthelot.io","https://berthelot.io",["Set"],["ShallowReactive",22],{"page-data-fr-react-test-refactoring-snapshot":-1},"/articles/react-test-refactoring-snapshot",1765672673327]</script><script>window.__NUXT__={};window.__NUXT__.config={public:{MAPS_URL:"",mdc:{components:{prose:true,map:{}},headings:{anchorLinks:{h1:false,h2:true,h3:true,h4:true,h5:false,h6:false}}},i18n:{baseUrl:"https://berthelot.io",defaultLocale:"fr",rootRedirect:"",redirectStatusCode:302,skipSettingLocaleOnNavigate:false,locales:[{code:"fr",name:"FR",iso:"fr-FR",isCatchallLocale:true,language:"fr-FR",_hreflang:"fr-FR",_sitemap:"fr-FR"},{code:"en",iso:"en-GB",name:"EN",language:"en-GB",_hreflang:"en-GB",_sitemap:"en-GB"}],detectBrowserLanguage:{alwaysRedirect:false,cookieCrossOrigin:false,cookieDomain:"",cookieKey:"i18n_redirected",cookieSecure:false,fallbackLocale:"",redirectOn:"root",useCookie:true},experimental:{localeDetector:"",typedPages:true,typedOptionsAndMessages:false,alternateLinkCanonicalQueries:true,devCache:false,cacheLifetime:"",stripMessagesPayload:false,preload:false,strictSeo:false,nitroContextDetection:true,httpCacheDuration:10},domainLocales:{fr:{domain:""},en:{domain:""}}},content:{wsUrl:""}},app:{baseURL:"/",buildId:"1a17b6f7-15b9-4dae-a90c-9fc95c1f74f0",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>